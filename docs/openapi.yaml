openapi: 3.0.0
info:
  title: Secure E-Voting System API
  description: API for managing university elections, nominations, verification, and voting.
  version: 1.0.0
servers:
  - url: http://localhost:3000/api
    description: Local Development Server
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Position:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        seats:
          type: integer
        opens_at:
          type: string
          format: date-time
        closes_at:
          type: string
          format: date-time
    Candidate:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        position_id:
          type: integer
        status:
          type: string
          enum: [SUBMITTED, APPROVED, REJECTED]
    Error:
      type: object
      properties:
        message:
          type: string
paths:
  /auth/login:
    post:
      summary: Admin/Officer Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
  /positions:
    get:
      summary: List all positions
      responses:
        "200":
          description: List of positions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Position"
    post:
      summary: Create a new position
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Position"
      responses:
        "201":
          description: Position created
  /candidates:
    post:
      summary: Candidate Self-Registration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                position_id:
                  type: integer
                manifesto_url:
                  type: string
                photo_url:
                  type: string
      responses:
        "201":
          description: Candidate registered
  /verify/request-otp:
    post:
      summary: Request OTP for verification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reg_no:
                  type: string
      responses:
        "200":
          description: OTP sent
  /verify/confirm:
    post:
      summary: Confirm OTP and get Ballot Token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reg_no:
                  type: string
                otp:
                  type: string
      responses:
        "200":
          description: Verification successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  ballot_token:
                    type: string
  /vote:
    post:
      summary: Cast Vote
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                votes:
                  type: array
                  items:
                    type: object
                    properties:
                      positionId:
                        type: integer
                      candidateId:
                        type: integer
      responses:
        "200":
          description: Vote cast successfully
  /reports/turnout:
    get:
      summary: Get live turnout stats
      responses:
        "200":
          description: Turnout statistics
